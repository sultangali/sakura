# Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ CORS Ð¿Ñ€Ð¸ Ð´ÐµÐ¿Ð»Ð¾Ðµ Ð½Ð° Ð¾Ð±Ð»Ð°Ñ‡Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°

ÐŸÑ€Ð¸ Ð´ÐµÐ¿Ð»Ð¾Ðµ Ð½Ð° Ð¾Ð±Ð»Ð°Ñ‡Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:
```
Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://localhost:5000/api/groups
Status code: (null)
```

Ð­Ñ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ Ðº `localhost:5000` Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°.

## ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°

ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð±Ñ‹Ð»Ð° Ð¶ÐµÑÑ‚ÐºÐ¾ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÐ°Ð½Ð° Ð½Ð° `localhost:5000` Ð¸ Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐ»Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹/Ð¾Ð±Ð»Ð°Ñ‡Ð½Ñ‹Ð¹).

## Ð ÐµÑˆÐµÐ½Ð¸Ðµ

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: ÐŸÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸ Ð·Ð°Ð´ÐµÐ¿Ð»Ð¾Ð¸Ñ‚ÑŒ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)

```bash
# ÐÐ° ÑÐµÑ€Ð²ÐµÑ€Ðµ
cd /path/to/platonus-buketov

# ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐºÐ¾Ð´ (ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ git)
git pull

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð½Ð¾Ð²Ð¾
sudo ./deploy.sh
```

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ `deploy.sh` Ñ‚ÐµÐ¿ÐµÑ€ÑŒ:
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÑÑ‚ `.env.production` Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸
- âœ… Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ `VITE_FORCE_CLOUD=true` Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°
- âœ… ÐŸÐµÑ€ÐµÑÐ¾Ð±ÐµÑ€ÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÐµÐ¹

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð ÑƒÑ‡Ð½Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

#### Ð¨Ð°Ð³ 1: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ .env.production

```bash
cd client
cat > .env.production << EOF
VITE_SERVER_IP=34.88.233.59
VITE_LOCAL_PORT=5000
VITE_FORCE_CLOUD=true
EOF
```

#### Ð¨Ð°Ð³ 2: ÐŸÐµÑ€ÐµÑÐ¾Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚

```bash
cd client
npm run build
```

#### Ð¨Ð°Ð³ 3: Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð² production

```bash
sudo cp -r client/dist/* /var/www/platonus/client/
```

#### Ð¨Ð°Ð³ 4: ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Nginx

```bash
sudo systemctl reload nginx
```

## ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ¶Ð¸Ð¼Ð°

ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ `config.js` Ñ‚ÐµÐ¿ÐµÑ€ÑŒ:

1. **Ð’ development** (localhost:5173):
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ `http://localhost:5000/api`
   - Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Vite proxy

2. **Ð’ production** (34.88.233.59):
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸ `/api`
   - Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Nginx (ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ð½Ð° localhost:5000)

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ¶Ð¸Ð¼Ð°

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð° (F12) Ð½Ð° Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ðµ. Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:

```
â˜ï¸ Ð ÐµÐ¶Ð¸Ð¼: ÐžÐ‘Ð›ÐÐ§ÐÐ«Ð™ (Production)
   Ð¡ÐµÑ€Ð²ÐµÑ€: 34.88.233.59
   API URL: /api
   Server URL: 
   Mode: production
   PROD: true
```

Ð•ÑÐ»Ð¸ Ð²Ð¸Ð´Ð¸Ñ‚Ðµ `ðŸ”§ Ð ÐµÐ¶Ð¸Ð¼: Ð›ÐžÐšÐÐ›Ð¬ÐÐ«Ð™`, Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð¿ÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ð½ Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÑ‚Ð°Ñ€Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ.

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ `http://34.88.233.59` Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ
2. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ (F12) â†’ Console
3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ "ÐžÐ‘Ð›ÐÐ§ÐÐ«Ð™ (Production)"
4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Network tab - Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¸Ð´Ñ‚Ð¸ Ð½Ð° `/api/*` (Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸)
5. ÐÐµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±Ð¾Ðº CORS

## Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð¾ÑÑ‚Ð°Ð»Ð°ÑÑŒ

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ CORS Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½
pm2 status

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°
pm2 logs platonus-server --lines 50

# Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ CORS Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð² server/index.js:
# app.use(cors({ origin: '*', ... }))
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Nginx

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
sudo nginx -t

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸
sudo tail -f /var/log/nginx/platonus_error.log
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ±Ð¾Ñ€ÐºÑƒ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ dist ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
ls -la /var/www/platonus/client/

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð² index.html Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸
head -20 /var/www/platonus/client/index.html
```

## Ð’Ð°Ð¶Ð½Ð¾

- **ÐŸÐ¾ÑÐ»Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð² `config.js` Ð²ÑÐµÐ³Ð´Ð° Ð¿ÐµÑ€ÐµÑÐ¾Ð±Ð¸Ñ€Ð°Ð¹Ñ‚Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚**: `npm run build`
- **Ð’ production Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸** (`/api`), Ð° Ð½Ðµ Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ñ‹Ðµ (`http://...`)
- **Nginx Ð¿Ñ€Ð¾ÐºÑÐ¸Ñ€ÑƒÐµÑ‚** `/api` Ð½Ð° `localhost:5000`, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½



